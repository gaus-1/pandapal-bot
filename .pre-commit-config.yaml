# Pre-commit hooks –¥–ª—è PandaPal

repos:
  # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: üßπ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫
      - id: end-of-file-fixer
        name: üìÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–æ–≤
      - id: check-yaml
        name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
        exclude: ^(frontend/.*\.yml$|\.github/workflows/.*\.yml$)
      - id: check-added-large-files
        name: üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>1MB)
        args: ['--maxkb=4096']
      - id: check-merge-conflict
        name: ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ —Å–ª–∏—è–Ω–∏—è
      - id: check-json
        name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
        exclude: ^(frontend/.*\.json$|.*tsconfig.*\.json$)
      - id: mixed-line-ending
        name: üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–π —Å—Ç—Ä–æ–∫
        args: ['--fix=lf']

  # Ruff: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥ (–∑–∞–º–µ–Ω—è–µ—Ç black, isort, flake8)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–∑–∞–º–µ–Ω—è–µ—Ç black)
      - id: ruff-format
        name: üé® ruff format - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
        exclude: ^(tests/|scripts/|alembic/)
      # –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (–∑–∞–º–µ–Ω—è–µ—Ç flake8 + isort)
      - id: ruff
        name: üîç ruff - –ª–∏–Ω—Ç–∏–Ω–≥ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (PEP8)
        args: ['--fix', '--exit-non-zero-on-fix']
        exclude: ^(tests/|scripts/|alembic/)

  # Radon: —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ (manual)
  - repo: local
    hooks:
      - id: radon-complexity
        name: üìä radon - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (SOLID)
        entry: powershell -Command "python -m radon cc bot/ --min B --show-complexity --average"
        language: system
        types: [python]
        files: ^bot/.*\.py$
        exclude: ^(tests/|scripts/|alembic/)
        pass_filenames: false
        stages: [manual]  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é: pre-commit run radon-complexity --all-files

  # mypy: —Ç–∏–ø—ã (manual)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0  # –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å v1.18.2 (–±—ã–ª–∞ –æ–ø–µ—á–∞—Ç–∫–∞, –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    hooks:
      - id: mypy
        name: üî¨ mypy - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (soft)
        additional_dependencies:
          - types-requests
          - types-setuptools
          - types-aiofiles
        args:
          - '--ignore-missing-imports'
          - '--no-strict-optional'
          - '--show-error-codes'
          - '--warn-unused-ignores'
          - '--no-error-summary'
        exclude: ^(tests/|scripts/|alembic/|bot/services/|bot/handlers/)
        # –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–º–∏—Ç, —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç
        verbose: true
        stages: [manual]  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑: git commit --no-verify

  # pylint: SOLID –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
  - repo: https://github.com/pycqa/pylint
    rev: v4.0.2
    hooks:
      - id: pylint
        name: üîé pylint - –ø—Ä–æ–≤–µ—Ä–∫–∞ SOLID –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
        args:
          - '--max-line-length=100'
          - '--disable=C0114,C0115,C0116,R0903,R0913,E0401,W0611,E0013,R0801,C0301'
          - '--fail-under=6.5'  # –ú—è–≥–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –Ω–∞—á–∞–ª–∞
          - '--enable=R0902,R0912'  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤/—Ñ—É–Ω–∫—Ü–∏–π (SOLID)
        exclude: ^(tests/|scripts/|alembic/|bot/config\.py)
        # –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–º–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
        # –í–∫–ª—é—á–µ–Ω –≤ –æ–±—ã—á–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é stage: pre-commit)

  # bandit: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (manual)
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        name: üõ°Ô∏è bandit - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        args: ['-r', 'bot/', '-ll', '--skip', 'B101,B601,B104', '-f', 'text']
        exclude: ^(tests/|scripts/)
        pass_filenames: false
        verbose: true
        stages: [manual]  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é: pre-commit run bandit --all-files

  # safety –æ—Ç–∫–ª—é—á–µ–Ω; –≤—Ä—É—á–Ω—É—é: safety check
  # - repo: https://github.com/Lucas-C/pre-commit-hooks-safety
  #   rev: v1.3.3
  #   hooks:
  #     - id: python-safety-dependencies
  #       name: üîí safety - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π Python
  #       args: ['--continue-on-failure']
  #       stages: [manual]  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é: pre-commit run python-safety-dependencies --all-files

  - repo: local
    hooks:
      - id: typescript-check
        name: üî∑ TypeScript - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
        entry: powershell -Command "cd frontend; npm run type-check"
        language: system
        types: [file]
        files: ^frontend/src/.*\.(ts|tsx)$
        pass_filenames: false
        # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ .ts/.tsx —Ñ–∞–π–ª–æ–≤

      - id: eslint
        name: üîç ESLint - –ø—Ä–æ–≤–µ—Ä–∫–∞ TypeScript/JavaScript
        entry: powershell -Command "cd frontend; npm run lint"
        language: system
        types: [file]
        files: ^frontend/src/.*\.(ts|tsx|js|jsx)$
        pass_filenames: false
        # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ .ts/.tsx/.js/.jsx —Ñ–∞–π–ª–æ–≤

      - id: npm-audit
        name: üîí npm audit - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π Node.js
        entry: powershell -Command "cd frontend; npm audit --audit-level=moderate"
        language: system
        pass_filenames: false
        always_run: false
        stages: [manual]  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é: pre-commit run npm-audit --all-files

# –û–±—ã—á–Ω—ã–π –∫–æ–º–º–∏—Ç: git commit -m "feat: ..."
# –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫: git commit --no-verify -m "fix: ..."
# –í—Å—ë –≤—Ä—É—á–Ω—É—é: pre-commit run --all-files
# mypy: pre-commit run mypy --all-files
# bandit: pre-commit run bandit --all-files
# radon: pre-commit run radon-complexity --all-files
