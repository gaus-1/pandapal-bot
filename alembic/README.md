# Alembic - Миграции БД

Миграции базы данных PostgreSQL через Alembic. Когда нужно изменить структуру БД, создаешь миграцию.

## Структура

- `versions/` - файлы миграций (все изменения БД)
- `env.py` - конфигурация Alembic
- `script.py.mako` - шаблон для новых миграций

## Команды

### Создание миграции
Когда изменил модели в `bot/models.py`, создаешь миграцию:

```bash
alembic revision --autogenerate -m "описание изменений"
```

Alembic автоматически найдет изменения и создаст миграцию.

### Применение миграций
```bash
# Применить все миграции
alembic upgrade head

# Применить конкретную миграцию
alembic upgrade <revision>

# Откатить последнюю миграцию (если что-то пошло не так)
alembic downgrade -1
```

### Просмотр истории
```bash
# Текущая версия БД
alembic current

# История всех миграций
alembic history
```

## Правила

- Каждая миграция должна быть обратимой - если что-то пошло не так, можно откатить
- Не изменяй существующие миграции после применения - это сломает историю
- Тестируй миграции на тестовой БД перед применением - убедись что все работает
- Делай бэкап перед применением в production - на всякий случай

## Важно

- Миграции применяются автоматически при деплое на Railway
- Всегда проверяй миграции локально перед коммитом - запусти `alembic upgrade head`
- При конфликтах миграций - разрешай вручную, не игнорируй
