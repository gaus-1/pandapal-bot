<!doctype html>
<html lang="ru" class="light">
  <head>
    <meta charset="UTF-8" />

    <!-- Favicon для поисковых систем и браузеров -->
    <!-- ВАЖНО: Все фавиконы круглые (созданы из logo.png) -->
    <!-- Яндекс требует favicon.ico в корне сайта для отображения в результатах поиска -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <!-- Preload критических ресурсов для быстрой загрузки -->
    <link rel="preload" href="/logo.png" as="image" type="image/png" />
    <!-- PNG для современных браузеров - круглые фавиконы -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png" />
    <!-- Apple Touch Icon - круглый -->
    <link rel="apple-touch-icon" sizes="192x192" href="/favicon-192.png" />
    <!-- Для поисковых систем - круглые фавиконы -->
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512.png" />

    <!-- Поддержка светлой и темной темы -->
    <meta name="color-scheme" content="light dark" />
    <script>
      (function() {
        // Ранняя инициализация темы для предотвращения мигания
        // ВСЕГДА светлая тема по умолчанию при первом открытии
        try {
          // Принудительно устанавливаем светлую тему по умолчанию
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');

          // Читаем сохраненную тему только если она явно установлена пользователем
          const savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'dark') {
            // Пользователь выбрал темную тему - применяем её
            document.documentElement.classList.add('dark');
            document.documentElement.classList.remove('light');
          } else {
            // По умолчанию светлая тема - сохраняем в localStorage
            localStorage.setItem('theme', 'light');
          }
        } catch (e) {
          // Если localStorage недоступен - используем светлую тему
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');
        }
      })();
    </script>

    <!-- Viewport для адаптивности -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0" />

    <!-- Theme color для браузера (без PWA) -->
    <meta name="theme-color" content="#3b82f6" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1e293b" />

    <!-- Мобильные оптимизации -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="PandaPal" />

    <!-- Referrer policy для безопасности -->
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <title>PandaPal — Безопасный ИИ-друг для твоего ребенка</title>

    <!-- DNS prefetch для внешних ресурсов -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://mc.yandex.ru">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <!-- Google Fonts 2025: Poppins (заголовки) + Inter (текст) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Предзагрузка изображений панды для быстрого отображения реакций в играх -->
    <!-- Preload убран - изображения загружаются по требованию -->

    <!-- Canonical URL -->
    <link rel="canonical" href="https://pandapal.ru/">

    <!-- Language alternates -->
    <link rel="alternate" hreflang="ru" href="https://pandapal.ru/">
    <link rel="alternate" hreflang="en" href="https://pandapal.ru/">
    <link rel="alternate" hreflang="x-default" href="https://pandapal.ru/">

    <!-- SEO Meta Tags (Russian) -->
    <meta name="description" content="PandaPal — Telegram Mini App с ИИ для безопасного обучения школьников 1-9 классов. YandexGPT, обработка фото и аудио, модерация контента. Помогает с уроками по всем предметам, работает 24/7.">
    <meta name="keywords" content="PandaPal, Telegram Mini App, ИИ для детей, YandexGPT, образование, дети, обучение, школа, 1-9 класс, безопасность, Telegram бот, Yandex Cloud, SpeechKit, Vision OCR, AI для детей, образовательный бот, помощь с уроками, онлайн репетитор, безопасный AI, AI учитель, адаптивное обучение, голосовой помощник, чат-бот репетитор">
    <meta name="author" content="PandaPal Team">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="yandex" content="index, follow">
    <meta name="language" content="Russian, English">
    <meta name="revisit-after" content="7 days">

    <!-- SEO Meta Tags (English) -->
    <meta name="description" lang="en" content="PandaPal — Safe and Useful AI Friend for Children. Telegram Mini App with YandexGPT for secure learning for students grades 1-9. Photo and audio processing, content moderation, emergency numbers. Works 24/7 on Railway.app.">
    <meta name="keywords" lang="en" content="PandaPal, Telegram Mini App, AI for kids, YandexGPT, education, children, learning, school, grades 1-9, safety, Telegram bot, Yandex Cloud, SpeechKit, Vision OCR, AI tutor, educational bot, homework help, online tutor, safe AI, AI teacher, adaptive learning, voice assistant, chatbot tutor">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="PandaPal — Безопасный ИИ-друг для твоего ребенка">
    <meta property="og:description" content="Telegram Mini App с ИИ для безопасного обучения школьников 1-9 классов. YandexGPT, обработка фото и аудио, модерация контента. Помогает с уроками по всем предметам, работает 24/7.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pandapal.ru">
    <meta property="og:image" content="https://pandapal.ru/favicon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:alt" content="PandaPal — Безопасный ИИ-друг для твоего ребенка">
    <meta property="og:site_name" content="PandaPal">
    <meta property="og:locale" content="ru_RU">
    <meta property="og:locale:alternate" content="en_US">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="PandaPal — Безопасный ИИ-друг для твоего ребенка">
    <meta name="twitter:description" content="Telegram Mini App с ИИ для безопасного обучения школьников 1-9 классов. YandexGPT, обработка фото и аудио, модерация контента. Помогает с уроками по всем предметам.">
    <meta name="twitter:image" content="https://pandapal.ru/favicon-512.png">
    <meta name="twitter:site" content="@PandaPal">
    <meta name="twitter:creator" content="@PandaPal">

    <!-- Yandex Webmaster -->
    <meta name="yandex-verification" content="3f9e35f6d79cfb2f" />

    <!-- Географическая привязка (Россия, Санкт-Петербург) -->
    <meta name="geo.region" content="RU-SPE" />
    <meta name="geo.placename" content="Санкт-Петербург" />
    <meta name="geo.position" content="59.934280;30.335098" />
    <meta name="ICBM" content="59.934280, 30.335098" />
    <meta name="geo.region" content="RU" />
    <meta name="geo.country" content="RU" />

    <!-- Structured Data (JSON-LD) - Russian -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "PandaPal",
      "alternateName": "PandaPal — Безопасный ИИ-друг для твоего ребенка",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Telegram",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "RUB"
      },
      "description": "Telegram Mini App с искусственным интеллектом для безопасного обучения школьников 1-9 классов. Использует YandexGPT, SpeechKit STT и Vision OCR для обработки текста, голоса и изображений.",
      "featureList": [
        "AI чат с YandexGPT",
        "Обработка фото через Yandex Vision",
        "Распознавание речи через Yandex SpeechKit",
        "Модерация контента (150+ фильтров)",
        "Экстренные номера России",
        "Адаптация под возраст (1-9 класс)"
      ],
      "author": {
        "@type": "Organization",
        "name": "PandaPal Team"
      },
      "inLanguage": ["ru", "en"],
      "keywords": "PandaPal, Telegram Mini App, ИИ для детей, YandexGPT, образование, дети, обучение, школа, безопасность, AI для детей, образовательный бот, помощь с уроками, онлайн репетитор"
    }
    </script>

    <!-- Organization Schema.org для лучшей индексации -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "PandaPal",
      "url": "https://pandapal.ru",
      "logo": "https://pandapal.ru/favicon-512.png",
      "description": "Безопасный ИИ-друг для детей 1-9 классов. Telegram Mini App с YandexGPT для помощи с уроками по всем предметам.",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "RU",
        "addressRegion": "Санкт-Петербург",
        "addressLocality": "Санкт-Петербург"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "59.934280",
        "longitude": "30.335098"
      },
      "areaServed": {
        "@type": "Country",
        "name": "Россия"
      },
      "sameAs": [
        "https://t.me/PandaPalBot"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Support",
        "availableLanguage": ["Russian", "English"]
      }
    }
    </script>

    <!-- Structured Data (JSON-LD) - English -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "PandaPal",
      "alternateName": "PandaPal — Safe and Useful AI Friend for Children",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Telegram",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Telegram Mini App with artificial intelligence for safe learning for students grades 1-9. Uses YandexGPT, SpeechKit STT and Vision OCR for text, voice and image processing.",
      "featureList": [
        "AI chat with YandexGPT",
        "Photo processing via Yandex Vision",
        "Speech recognition via Yandex SpeechKit",
        "Content moderation (150+ filters)",
        "Emergency numbers for Russia",
        "Age adaptation (grades 1-9)"
      ],
      "author": {
        "@type": "Organization",
        "name": "PandaPal Team"
      },
      "inLanguage": ["en", "ru"],
      "keywords": "PandaPal, Telegram Mini App, AI for kids, YandexGPT, education, children, learning, school, safety, AI tutor, educational bot, homework help, online tutor"
    }
    </script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=104525544', 'ym');

        ym(104525544, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <!-- /Yandex.Metrika counter -->
  </head>
  <body>
    <noscript><img src="https://mc.yandex.ru/watch/104525544" style="position:absolute; left:-9999px;" alt="" /></noscript>

    <!-- Яндекс.Вебмастер: Счетчик ИКС (Индекс Качества Сайта) -->
    <a href="https://webmaster.yandex.ru/siteinfo/?site=pandapal.ru" id="yandex-iks-counter" style="position: fixed; bottom: 10px; left: 10px; z-index: 1000; display: none; text-decoration: none;">
      <img width="60" height="21" alt="Индекс качества сайта" border="0" style="border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);" src="https://yandex.ru/cycounter?pandapal.ru&theme=light&lang=ru"/>
    </a>
    <script>
      // Показываем счетчик ИКС только на основном сайте (не в Mini App)
      (function() {
        function updateCounterPosition() {
          if (typeof window !== 'undefined' && window.location.hostname === 'pandapal.ru') {
            const counter = document.getElementById('yandex-iks-counter');
            if (counter) {
              // Проверяем, находимся ли мы в Mini App (есть tgaddr или Telegram WebApp)
              const isMiniApp = window.location.search.includes('tgaddr') ||
                               (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp);

              if (isMiniApp) {
                // В Mini App - скрываем кнопку
                counter.style.display = 'none';
              } else {
                // На основном сайте - в левом нижнем углу
                counter.style.display = 'block';
                counter.style.position = 'fixed';
                counter.style.bottom = '10px';
                counter.style.left = '10px';
                counter.style.zIndex = '999';
              }
            }
          }
        }

        // Выполняем сразу и после загрузки DOM
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', updateCounterPosition);
        } else {
          updateCounterPosition();
        }

        // Также обновляем при изменении размера окна
        window.addEventListener('resize', updateCounterPosition);
      })();
    </script>

    <div id="root"></div>
    <script>
      // РАННЕЕ подавление ошибок Telegram WebView (до загрузки React)
      (function() {
        if (typeof window === 'undefined') return;

        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;

        // Перехватываем window.onerror для глобальных ошибок
        window.onerror = function(msg, url, line, col, error) {
          const message = String(msg || '');
          const urlStr = String(url || '');
          if (
            message.includes('[SW]') ||
            message.includes('SW registration failed') ||
            message.includes('no controller') ||
            message.includes('MP-MTPROTO') ||
            message.includes('mtprotoworker') ||
            message.includes('mtprotoworker.ts') ||
            message.includes('logger.ts') ||
            urlStr.includes('mtprotoworker.ts') ||
            urlStr.includes('logger.ts')
          ) {
            return true; // Подавляем ошибку
          }
          return false; // Показываем остальные ошибки
        };

        console.error = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('SW registration failed') ||
            message.includes('no controller') ||
            message.includes('no windows left') ||
            message.includes('it is not a window') ||
            message.includes('peer changed') ||
            message.includes('device-orientation') ||
            message.includes('Unrecognized feature') ||
            message.includes('MP-MTPROTO') ||
            message.includes('Service Worker') ||
            message.includes('mtprotoworker') ||
            message.includes('mtprotoworker.ts') ||
            message.includes('logger.ts') ||
            message.includes('telegramWebView.ts')
          ) {
            return; // Подавляем эти ошибки
          }
          originalError.apply(console, args);
        };

        console.warn = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('device-orientation') ||
            message.includes('Unrecognized feature') ||
            message.includes('Service Worker') ||
            message.includes('logger.ts') ||
            message.includes('telegramWebView.ts')
          ) {
            return; // Подавляем эти предупреждения
          }
          originalWarn.apply(console, args);
        };

        // Подавляем логи от Telegram WebView
        console.log = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('MP-MTPROTO') ||
            message.includes('mtprotoworker')
          ) {
            return; // Подавляем эти логи
          }
          originalLog.apply(console, args);
        };
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
