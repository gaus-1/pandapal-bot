<!doctype html>
<html lang="ru" class="light">
  <head>
    <meta charset="UTF-8" />

    <!-- Favicon - используем логотип панды -->
    <link rel="icon" type="image/png" sizes="32x32" href="/logo.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/logo.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/logo.png" />
    <link rel="shortcut icon" href="/logo.png" />

    <!-- Принудительная светлая тема по умолчанию -->
    <meta name="color-scheme" content="light dark" />
    <script>
      (function() {
        // Проверяем сохраненную тему
        const savedTheme = localStorage.getItem('theme');

        // Если нет сохраненной темы - принудительно ставим светлую
        if (!savedTheme || savedTheme === 'null' || savedTheme === 'undefined') {
          localStorage.setItem('theme', 'light');
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');
        } else if (savedTheme === 'dark') {
          document.documentElement.classList.add('dark');
          document.documentElement.classList.remove('light');
        } else {
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');
        }
      })();
    </script>

    <!-- Viewport для адаптивности -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="PandaPal" />

    <title>PandaPal — Безопасный ИИ-друг для твоего ребенка</title>

    <!-- Google Fonts 2025: Poppins (заголовки) + Inter (текст) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- SEO Meta Tags -->
    <meta name="description" content="PandaPal — Telegram Mini App с ИИ для безопасного обучения школьников 1-9 классов. YandexGPT, обработка фото и аудио, модерация контента, экстренные номера. Работает 24/7 на Railway.app.">
    <meta name="keywords" content="PandaPal, Telegram Mini App, ИИ для детей, YandexGPT, образование, дети, обучение, школа, 1-9 класс, безопасность, Telegram бот, Yandex Cloud, SpeechKit, Vision OCR">
    <meta name="author" content="PandaPal Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Russian">
    <meta name="revisit-after" content="7 days">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="PandaPal — Telegram Mini App с ИИ для безопасного обучения детей">
    <meta property="og:description" content="Telegram Mini App с YandexGPT, обработкой фото и аудио. Безопасное обучение для школьников 1-9 классов. Модерация контента, экстренные номера, работает 24/7.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pandapal.ru">
    <meta property="og:image" content="https://pandapal.ru/logo.png">
    <meta property="og:site_name" content="PandaPal">
    <meta property="og:locale" content="ru_RU">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PandaPal — Telegram Mini App с ИИ для безопасного обучения детей">
    <meta name="twitter:description" content="Telegram Mini App с YandexGPT, обработкой фото и аудио. Безопасное обучение для школьников 1-9 классов.">
    <meta name="twitter:image" content="https://pandapal.ru/logo.png">

    <!-- Yandex Webmaster -->
    <meta name="yandex-verification" content="">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "PandaPal",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "Telegram",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "RUB"
      },
      "description": "Telegram Mini App с искусственным интеллектом для безопасного обучения школьников 1-9 классов. Использует YandexGPT, SpeechKit STT и Vision OCR для обработки текста, голоса и изображений.",
      "featureList": [
        "AI чат с YandexGPT",
        "Обработка фото через Yandex Vision",
        "Распознавание речи через Yandex SpeechKit",
        "Модерация контента (150+ фильтров)",
        "Экстренные номера России",
        "Адаптация под возраст (1-9 класс)"
      ],
      "author": {
        "@type": "Organization",
        "name": "PandaPal Team"
      }
    }
    </script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=104525544', 'ym');

        ym(104525544, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/104525544" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
  </head>
  <body>
    <div id="root"></div>
    <script>
      // РАННЕЕ подавление ошибок Telegram WebView (до загрузки React)
      (function() {
        if (typeof window === 'undefined') return;

        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;

        // Перехватываем window.onerror для глобальных ошибок
        window.onerror = function(msg, url, line, col, error) {
          const message = String(msg || '');
          const urlStr = String(url || '');
          if (
            message.includes('[SW]') ||
            message.includes('SW registration failed') ||
            message.includes('no controller') ||
            message.includes('MP-MTPROTO') ||
            message.includes('mtprotoworker') ||
            message.includes('mtprotoworker.ts') ||
            message.includes('logger.ts') ||
            urlStr.includes('mtprotoworker.ts') ||
            urlStr.includes('logger.ts')
          ) {
            return true; // Подавляем ошибку
          }
          return false; // Показываем остальные ошибки
        };

        console.error = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('SW registration failed') ||
            message.includes('no controller') ||
            message.includes('no windows left') ||
            message.includes('it is not a window') ||
            message.includes('peer changed') ||
            message.includes('device-orientation') ||
            message.includes('Unrecognized feature') ||
            message.includes('MP-MTPROTO') ||
            message.includes('Service Worker') ||
            message.includes('mtprotoworker') ||
            message.includes('mtprotoworker.ts') ||
            message.includes('logger.ts') ||
            message.includes('telegramWebView.ts')
          ) {
            return; // Подавляем эти ошибки
          }
          originalError.apply(console, args);
        };

        console.warn = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('device-orientation') ||
            message.includes('Unrecognized feature') ||
            message.includes('Service Worker') ||
            message.includes('logger.ts') ||
            message.includes('telegramWebView.ts')
          ) {
            return; // Подавляем эти предупреждения
          }
          originalWarn.apply(console, args);
        };

        // Подавляем логи от Telegram WebView
        console.log = function(...args) {
          const message = String(args.join(' '));
          if (
            message.includes('[SW]') ||
            message.includes('MP-MTPROTO') ||
            message.includes('mtprotoworker')
          ) {
            return; // Подавляем эти логи
          }
          originalLog.apply(console, args);
        };
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
