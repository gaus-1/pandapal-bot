# ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 02.01.2026
**–¶–µ–ª—å:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î

**–§–∞–π–ª:** `bot/database.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `pool_size`: 5 ‚Üí **20** (–±–∞–∑–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- `max_overflow`: 15 ‚Üí **30** (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
- `pool_timeout`: 30 ‚Üí **60** —Å–µ–∫—É–Ω–¥
- **–ò—Ç–æ–≥–æ:** –î–æ 50 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–±—ã–ª–æ: 20)

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –æ–∂–∏–¥–∞–Ω–∏—è –ë–î
- –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ —Å 1-5 —Å–µ–∫ –¥–æ <1 —Å–µ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### 2. ‚úÖ –ó–∞–º–µ–Ω–∞ requests –Ω–∞ httpx (async)

**–§–∞–π–ª:** `bot/services/yandex_cloud_service.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω `import requests` –Ω–∞ `import httpx`
- –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ async —á–µ—Ä–µ–∑ `httpx.AsyncClient`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤

**–ú–µ—Ç–æ–¥—ã:**
- `generate_text_response()` - YandexGPT –∑–∞–ø—Ä–æ—Å—ã
- `recognize_speech()` - SpeechKit STT –∑–∞–ø—Ä–æ—Å—ã
- `analyze_image_with_text()` - Vision OCR –∑–∞–ø—Ä–æ—Å—ã

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ event loop
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –º–µ–¥–∏–∞-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ 2-3 —Ä–∞–∑–∞
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–µ—Ä–µ–¥—å –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤

**–§–∞–π–ª—ã:**
- `bot/services/ai_request_queue.py` (–Ω–æ–≤—ã–π –º–æ–¥—É–ª—å)
- `bot/services/yandex_cloud_service.py` (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.Semaphore` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
- –ú–∞–∫—Å–∏–º—É–º **12 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö** AI –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç rate limiting Yandex Cloud API
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- –ó–∞–¥–µ—Ä–∂–∫–∏: 5-15 —Å–µ–∫—É–Ω–¥ (–º–µ–¥–∏–∞), 1-3 —Å–µ–∫ (—Ç–µ–∫—Å—Ç)
- –†–∏—Å–∫ —Ç–∞–π–º–∞—É—Ç–æ–≤: –≤—ã—Å–æ–∫–∏–π
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ~50-70 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- –ó–∞–¥–µ—Ä–∂–∫–∏: **2-5 —Å–µ–∫—É–Ω–¥** (–º–µ–¥–∏–∞), **1-2 —Å–µ–∫** (—Ç–µ–∫—Å—Ç)
- –†–∏—Å–∫ —Ç–∞–π–º–∞—É—Ç–æ–≤: **–Ω–∏–∑–∫–∏–π**
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: **100+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫**

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—É–ª –ë–î
```python
pool_kwargs = {
    "pool_size": 20,        # –ë–∞–∑–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    "max_overflow": 30,     # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (–≤—Å–µ–≥–æ –¥–æ 50)
    "pool_timeout": 60,     # –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è
    "pool_recycle": 1800,   # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω
    "pool_pre_ping": True,  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
}
```

### HTTP –∫–ª–∏–µ–Ω—Ç
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è httpx.AsyncClient —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏
timeout = httpx.Timeout(30.0, connect=10.0)
async with httpx.AsyncClient(timeout=timeout) as client:
    response = await client.post(url, headers=..., json=...)
```

### –û—á–µ—Ä–µ–¥—å AI –∑–∞–ø—Ä–æ—Å–æ–≤
```python
# –ú–∞–∫—Å–∏–º—É–º 12 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
request_queue = get_ai_request_queue(max_concurrent=12)
result = await request_queue.process(_execute_request)
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –ù–µ –ª–æ–º–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –£–ª—É—á—à–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ—Ö–æ–¥—è—Ç –ª–∏–Ω—Ç–µ—Ä –±–µ–∑ –æ—à–∏–±–æ–∫

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –Ω–∞–≥—Ä—É–∑–∫–µ

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤–∞ –∫:
- ‚úÖ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–º–µ—à–∞–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –∞—É–¥–∏–æ)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã (1-5 —Å–µ–∫—É–Ω–¥)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `max_concurrent` –≤ –æ—á–µ—Ä–µ–¥–∏
