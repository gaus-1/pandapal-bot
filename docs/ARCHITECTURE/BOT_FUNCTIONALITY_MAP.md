# 🗺️ КАРТА ФУНКЦИОНАЛА PANDAPAL БОТА

## 📱 **ГЛАВНОЕ МЕНЮ (Reply клавиатура)**

### **Для детей (child):**
```
┌─────────────────────────────────────┐
│ 💬 Общение с AI  │ 📚 Помощь с уроками │
├─────────────────────────────────────┤
│ 📊 Мой прогресс  │ 🏆 Достижения       │
├─────────────────────────────────────┤
│        ⚙️ Настройки                  │
└─────────────────────────────────────┘
```

### **Для родителей (parent):**
```
┌─────────────────────────────────────┐
│ 💬 Общение с AI  │ 📚 Помощь с уроками │
├─────────────────────────────────────┤
│ 📊 Мой прогресс  │ 🏆 Достижения       │
├─────────────────────────────────────┤
│       👨‍👩‍👧 Контроль детей            │
├─────────────────────────────────────┤
│        ⚙️ Настройки                  │
└─────────────────────────────────────┘
```

### **Для учителей (teacher):**
```
┌─────────────────────────────────────┐
│ 💬 Общение с AI  │ 📚 Помощь с уроками │
├─────────────────────────────────────┤
│ 📊 Мой прогресс  │ 🏆 Достижения       │
├─────────────────────────────────────┤
│ 👩‍🏫 Мой класс    │ 📝 Создать задание  │
├─────────────────────────────────────┤
│        ⚙️ Настройки                  │
└─────────────────────────────────────┘
```

---

## 🎯 **СТРУКТУРА НАВИГАЦИИ**

### **1. 💬 Общение с AI**
**Handler:** `bot/handlers/ai_chat.py` → `start_ai_chat()`
**Статус:** ✅ Работает

**Функционал:**
- Активирует режим свободного общения с AI
- Gemini AI отвечает на все вопросы
- Сохраняет историю (200 сообщений)
- Автоудаление при достижении 400 сообщений
- Модерация контента

**Flow:**
```
Пользователь → "💬 Общение с AI"
              ↓
         Режим активирован
              ↓
    Все сообщения → AI → Ответ
```

---

### **2. 📚 Помощь с уроками**
**Handler:** `bot/handlers/menu.py` → `homework_help()`
**Статус:** ✅ Реализовано сегодня

**Функционал:**
- Выбор предмета (9 предметов)
- Выбор типа помощи (4 типа)
- Специализированная помощь по контексту

**Flow:**
```
Пользователь → "📚 Помощь с уроками"
              ↓
    Inline клавиатура с предметами:
    ┌──────────────────────────────┐
    │ 🔢 Математика │ 📖 Русский   │
    │ 🌍 Окр. мир   │ 🇬🇧 Английский│
    │ ⚗️ Химия       │ 🔬 Физика    │
    │ 📜 История    │ 🌎 География │
    │      🎨 Другой предмет        │
    └──────────────────────────────┘
              ↓
    Выбор типа помощи:
    ┌──────────────────────────────┐
    │      📝 Решить задачу         │
    │      📚 Объяснить тему        │
    │      ✅ Проверить ответ       │
    │      💡 Дать подсказку        │
    │         🔙 Назад             │
    └──────────────────────────────┘
              ↓
         AI помощник активирован
```

---

### **3. 📊 Мой прогресс**
**Handler:** `bot/handlers/menu.py` → `show_progress()`
**Статус:** ✅ Реализовано сегодня

**Показывает:**
- Профиль пользователя (имя, класс, возраст)
- Статистика (сообщения, вопросы, дни)
- Достижения (в разработке)

**Flow:**
```
Пользователь → "📊 Мой прогресс"
              ↓
    ┌─────────────────────────────┐
    │     📊 Твой прогресс        │
    │                              │
    │  👤 Профиль:                 │
    │   • Имя: Вячеслав            │
    │   • Класс: 5                 │
    │   • Возраст: 11              │
    │                              │
    │  📈 Статистика:              │
    │   • Сообщений: 120           │
    │   • Вопросов: 45             │
    │   • Дней активности: 7       │
    │                              │
    │  🏆 Достижения: 3/15         │
    └─────────────────────────────┘
```

---

### **4. 🏆 Достижения** (НОВОЕ - в разработке)
**Handler:** Нужно создать `bot/handlers/achievements.py`
**Статус:** 🚧 Запланировано на завтра

**Планируемый функционал:**
- Список всех достижений
- Прогресс по каждому
- Система уровней (Level 1-10)
- Награды и бейджи

**Примеры достижений:**
```
🌟 Первый шаг          - Первое сообщение (10 XP)
💬 Болтун             - 100 сообщений (50 XP)
❓ Любознательный     - 50 вопросов (100 XP)
🔥 Неделя подряд      - 7 дней активности (200 XP)
🎓 Отличник           - 20 правильных ответов (150 XP)
📚 Эрудит             - Вопросы по 5+ предметам (300 XP)
🏆 Чемпион            - 1000 XP (500 XP бонус)
```

**Flow:**
```
Пользователь → "🏆 Достижения"
              ↓
    Inline клавиатура:
    ┌──────────────────────────────┐
    │     🏅 Мои достижения         │
    │   🎯 Доступные награды        │
    │        📈 Рейтинг            │
    │       🔙 Главное меню        │
    └──────────────────────────────┘
              ↓
    Детальный просмотр
```

---

### **5. ⚙️ Настройки**
**Handler:** `bot/handlers/settings.py` → `show_settings()`
**Статус:** ✅ Работает частично

**Текущие настройки:**
- 👤 Изменить имя
- 🎂 Указать возраст
- 🎓 Указать класс
- 🗑️ Очистить историю чата

**Нужно добавить:**
- 🔔 Уведомления (вкл/выкл)
- 🎨 Стиль общения (игровой/серьёзный)
- 🌙 Режим "Не беспокоить"

**Flow:**
```
Пользователь → "⚙️ Настройки"
              ↓
    Inline клавиатура:
    ┌──────────────────────────────┐
    │      👤 Изменить имя          │
    │  🎂 Возраст  │  🎓 Класс     │
    │    🗑️ Очистить историю        │
    │       🔙 Главное меню        │
    └──────────────────────────────┘
```

---

---

### **7. 👩‍🏫 Мой класс** (для учителей)
**Handler:** Нужно создать `bot/handlers/teacher.py`
**Статус:** 🚧 Запланировано на завтра

**Планируемые кнопки:**
```
┌──────────────────────────────────┐
│      👥 Список учеников           │
│      📊 Статистика класса         │
│      📝 Активные задания          │
│    ✅ Проверить работы            │
│       🔙 Главное меню            │
└──────────────────────────────────┘
```

---

### **8. 📝 Создать задание** (для учителей)
**Handler:** Нужно создать `bot/handlers/teacher.py`
**Статус:** 🚧 Запланировано на завтра

**Flow создания задания:**
```
Учитель → "📝 Создать задание"
         ↓
    Выбор предмета
         ↓
    Выбор типа задания:
    ┌──────────────────────────────┐
    │      📖 Теория                │
    │      🔢 Задача                │
    │      ✅ Тест (5-10 вопросов)  │
    │      📝 Сочинение             │
    │    🔙 Назад                   │
    └──────────────────────────────┘
         ↓
    Gemini генерирует задание
         ↓
    Предпросмотр + подтверждение
         ↓
    Задание отправлено классу
```

---

## 🎮 **ИНТЕРАКТИВНОСТЬ И UX**

### **Принципы дизайна кнопок:**

**1. Эмодзи для визуального восприятия:**
- ✅ Каждая кнопка имеет эмодзи
- ✅ Эмодзи соответствуют действию
- ✅ Дети лучше воспринимают визуально

**2. Адаптивность:**
- ✅ `resize_keyboard=True` - кнопки подстраиваются под экран
- ✅ Максимум 2-3 кнопки в строке
- ✅ Placeholder подсказывает что делать

**3. Логическая группировка:**
- Основные действия (AI, Уроки) - первая строка
- Просмотр (Прогресс, Достижения) - вторая строка
- Настройки - отдельно внизу
- Специальные функции (родители/учителя) - между основными и настройками

**4. Навигация:**
- ✅ Всегда есть кнопка "🔙 Назад" или "🔙 Главное меню"
- ✅ Callback data структурированы: `action:parameter`
- ✅ Нет тупиковых экранов

---

## 📊 **КАРТА ВСЕХ CALLBACK DATA**

### **Меню:**
- `menu:main` - вернуться в главное меню

### **Предметы:**
- `subject:math` - математика
- `subject:russian` - русский
- `subject:world` - окружающий мир
- `subject:english` - английский
- `subject:chemistry` - химия
- `subject:physics` - физика
- `subject:history` - история
- `subject:geography` - география
- `subject:other` - другой предмет

### **Типы помощи:**
- `help:solve` - решить задачу
- `help:explain` - объяснить тему
- `help:check` - проверить ответ
- `help:hint` - дать подсказку

### **Настройки:**
- `settings:name` - изменить имя
- `settings:age` - указать возраст
- `settings:grade` - указать класс
- `settings:clear_history` - очистить историю
- `settings:link_child` - связать с ребёнком (для родителей)

### **Достижения (планируется):**
- `achievements:my` - мои достижения
- `achievements:available` - доступные награды
- `achievements:leaderboard` - рейтинг

### **Прогресс (планируется):**
- `progress:overall` - общая статистика
- `progress:subjects` - по предметам
- `progress:daily` - по дням

### **Подтверждения:**
- `confirm:{action}` - подтверждение действия
- `cancel:{action}` - отмена действия

---

## ✅ **ТЕКУЩИЙ СТАТУС ФУНКЦИОНАЛА**

### **РАБОТАЕТ ОТЛИЧНО (90-100%):**
- ✅ `/start` - приветствие и регистрация
- ✅ `💬 Общение с AI` - основной чат с Gemini
- ✅ `⚙️ Настройки` - профиль, возраст, класс
- ✅ Модерация контента
- ✅ История сообщений

### **РАБОТАЕТ ЧАСТИЧНО (50-70%):**
- 🟡 `📚 Помощь с уроками` - кнопки есть, но без умного роутинга
- 🟡 `📊 Мой прогресс` - показывает базовую статистику

### **НЕ РАБОТАЕТ (0%):**
- ❌ `🏆 Достижения` - кнопка есть, функционал нет
- ❌ `👨‍👩‍👧 Контроль детей` - кнопка есть, handler не подключен
- ❌ `👩‍🏫 Мой класс` - для учителей, не реализовано
- ❌ `📝 Создать задание` - для учителей, не реализовано

---

## 🚀 **ПЛАН УЛУЧШЕНИЯ КНОПОК**

### **ЗАВТРА - ПРИОРИТЕТ 1:**

**1. Создать handler для "🏆 Достижения":**
- Файл: `bot/handlers/achievements.py`
- Обработчик кнопки
- Показ достижений
- Система XP
- Тесты

**2. Улучшить "📚 Помощь с уроками":**
- Сохранять контекст выбранного предмета
- Передавать в AI информацию о предмете
- Специализированные промпты для каждого типа помощи

**3. Добавить "🎮 Игры и викторины":**
- Образовательные мини-игры
- Викторины по предметам
- Награды за правильные ответы

---

## 🎨 **УЛУЧШЕННЫЙ UX**

### **Добавить:**

**1. Быстрые ответы (inline кнопки в чате):**
```
AI: "Хочешь еще примеры?"
    [✅ Да]  [❌ Нет]  [💡 Дай подсказку]
```

**2. Контекстные меню:**
- После решения задачи: [📝 Еще задача] [📚 Объяснить] [🏠 Меню]
- После объяснения: [❓ Задать вопрос] [✅ Понятно] [🏠 Меню]

**3. Прогресс-бары:**
```
🏆 Достижение "Болтун"
████████░░░░░░░░░░ 40% (40/100 сообщений)
```

**4. Еженедельные напоминания:**
- "📊 Твой прогресс за неделю готов! [Посмотреть]"
- "🏆 Новое достижение доступно! [Открыть]"

---

## 📋 **ЧЕКЛИСТ КАЧЕСТВА КНОПОК**

### **✅ ЧТО УЖЕ ХОРОШО:**
- ✅ Все кнопки с эмодзи
- ✅ Логическая группировка
- ✅ Адаптивный размер
- ✅ Понятные названия
- ✅ Есть кнопки "Назад"

### **🔧 ЧТО НУЖНО ДОРАБОТАТЬ:**
- 🔧 Не все кнопки обрабатываются (50% handlers нет)
- 🔧 Нет контекстных быстрых ответов
- 🔧 Нет визуального прогресса
- 🔧 Нет уведомлений и напоминаний
- 🔧 Нет inline подсказок в процессе диалога

---

## 🎯 **ИТОГО:**

**Текущее состояние кнопок:** 6/10

**Что работает:** 50%
**Что нужно доработать:** 50%

**ЗАВТРА:** Реализую все недостающие handlers и улучшу UX! 🚀

---

**Этот документ - полная карта всего функционала бота!** 📍
