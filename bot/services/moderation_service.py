"""
–°–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–µ—Ç–µ–π.

–§–∏–ª—å—Ç—Ä—É–µ—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–µ–º—ã —Å —É—á—ë—Ç–æ–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
"""

import re
import secrets
from re import Pattern
from typing import Any

from loguru import logger

from bot.config import FORBIDDEN_PATTERNS, settings
from bot.interfaces import IModerationService
from bot.services.advanced_moderation import AdvancedModerationService, ModerationResult


class ContentModerationService(IModerationService):
    """–°–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–µ—Ç–µ–π."""

    # –ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø: —Ä–∞–∑—Ä–µ—à–∞–µ–º —à–∫–æ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏ —É—á–µ–±–Ω—ã–µ —Ç–µ–º—ã
    # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –≠—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ü–ï–†–í–´–ú–ò, –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Ç–µ–º
    EDUCATIONAL_CONTEXTS = [
        # === –ì–ï–û–ì–†–ê–§–ò–Ø ===
        "–≥–µ–æ–≥—Ä–∞—Ñ–∏—è",
        "–≥–µ–æ–≥—Ä–∞—Ñ–∏—è —Ä–æ—Å—Å–∏–∏",
        "–≥–µ–æ–≥—Ä–∞—Ñ–∏—è –º–∏—Ä–∞",
        "–∫–∞—Ä—Ç–∞",
        "–∫–∞—Ä—Ç—É",
        "–∫–∞—Ä—Ç—ã",
        "–∫–∞—Ä—Ç–∞ —Ä–æ—Å—Å–∏–∏",
        "–∫–∞—Ä—Ç–∞ –º–∏—Ä–∞",
        "–ø–æ–∫–∞–∂–∏ –∫–∞—Ä—Ç—É",
        "–Ω–∞—Ä–∏—Å—É–π –∫–∞—Ä—Ç—É",
        "—Å–æ–∑–¥–∞–π –∫–∞—Ä—Ç—É",
        "—Å–æ—Å—Ç–∞–≤—å –∫–∞—Ä—Ç—É",
        "–ø–æ—Å—Ç—Ä–æ–π –∫–∞—Ä—Ç—É",
        "–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è",
        "—Å—Ç–æ–ª–∏—Ü–∞",
        "—Å—Ç—Ä–∞–Ω–∞",
        "—Å—Ç—Ä–∞–Ω—ã",
        "–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç",
        "–æ–∫–µ–∞–Ω",
        "—Ä–µ–∫–∞",
        "–≥–æ—Ä–∞",
        "–≥–æ—Ä–æ–¥",
        "—Ä–æ—Å—Å–∏—è",
        "—Ä–æ—Å–∏–∏–∏",
        "—Ä–æ—Å—Å–∏–π",
        # === –ò–°–¢–û–†–ò–Ø ===
        "–∏—Å—Ç–æ—Ä–∏—è",
        "–∏—Å—Ç–æ—Ä–∏—è —Ä–æ—Å—Å–∏–∏",
        "–∏—Å—Ç–æ—Ä–∏—è –¥—Ä–µ–≤–Ω–µ–≥–æ –º–∏—Ä–∞",
        "–∏—Å—Ç–æ—Ä–∏—è —Å—Ä–µ–¥–Ω–∏—Ö –≤–µ–∫–æ–≤",
        "—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –∏—Å—Ç–æ—Ä–∏—é",
        "–æ–±—ä—è—Å–Ω–∏ –∏—Å—Ç–æ—Ä–∏—é",
        "–ø–æ–º–æ–≥–∏ —Å –∏—Å—Ç–æ—Ä–∏–µ–π",
        "–¥–∞—Ç–∞",
        "–≥–æ–¥",
        "–≤–µ–∫",
        "—ç–ø–æ—Ö–∞",
        "–≤–æ–π–Ω–∞",  # –í –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ
        "—Å—Ä–∞–∂–µ–Ω–∏–µ",
        "–±–∏—Ç–≤–∞",
        # === –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê ===
        "–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
        "–∑–∞–¥–∞—á–∞",
        "—Ä–µ—à–∏—Ç—å",
        "—Å–∫–æ–ª—å–∫–æ",
        "–≤—ã—á–∏—Å–ª–∏",
        "–ø–æ—Å—á–∏—Ç–∞–π",
        "–Ω–∞–π–¥–∏",
        "–¥–æ–∫–∞–∂–∏",
        "–≤–º–µ—Å—Ç–µ",
        "–±—ã–ª–æ",
        "—Ç–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è",
        "—Ç–∞–±–ª–∏—Ü–∞",
        "—É–º–Ω–æ–∂–µ–Ω–∏–µ",
        "–¥–µ–ª–µ–Ω–∏–µ",
        "—Å–ª–æ–∂–µ–Ω–∏–µ",
        "–≤—ã—á–∏—Ç–∞–Ω–∏–µ",
        "–≥—Ä–∞—Ñ–∏–∫",
        "–¥–∏–∞–≥—Ä–∞–º–º–∞",
        "—É—Ä–∞–≤–Ω–µ–Ω–∏–µ",
        "—Ñ–æ—Ä–º—É–ª–∞",
        "—á–∏—Å–ª–æ",
        "—Ü–∏—Ñ—Ä–∞",
        # === –§–ò–ó–ò–ö–ê ===
        "—Ñ–∏–∑–∏–∫–∞",
        "—Å–∏–ª–∞",
        "—ç–Ω–µ—Ä–≥–∏—è",
        "—Å–∫–æ—Ä–æ—Å—Ç—å",
        "—É—Å–∫–æ—Ä–µ–Ω–∏–µ",
        "–º–∞—Å—Å–∞",
        "–∑–∞–∫–æ–Ω",
        "–æ–ø—ã—Ç",
        "—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç",
        # === –•–ò–ú–ò–Ø ===
        "—Ö–∏–º–∏—è",
        "—Ç–∞–±–ª–∏—Ü–∞ –º–µ–Ω–¥–µ–ª–µ–µ–≤–∞",
        "–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞",
        "–º–µ–Ω–¥–µ–ª–µ–µ–≤–∞",
        "—ç–ª–µ–º–µ–Ω—Ç",
        "–≤–µ—â–µ—Å—Ç–≤–æ",
        "—Ä–µ–∞–∫—Ü–∏—è",
        "–º–æ–ª–µ–∫—É–ª–∞",
        "–∞—Ç–æ–º",
        # === –ë–ò–û–õ–û–ì–ò–Ø ===
        "–±–∏–æ–ª–æ–≥–∏—è",
        "—Ä–∞—Å—Ç–µ–Ω–∏–µ",
        "–∂–∏–≤–æ—Ç–Ω–æ–µ",
        "–∫–ª–µ—Ç–∫–∞",
        "–æ—Ä–≥–∞–Ω",
        "—Å–∏—Å—Ç–µ–º–∞",
        "–æ—Ä–≥–∞–Ω–∏–∑–º",
        # === –†–£–°–°–ö–ò–ô –Ø–ó–´–ö ===
        "—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫",
        "–ø–æ–¥—á–µ—Ä–∫–Ω–∏",
        "—Å–ª–æ–≤–æ",
        "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
        "—Å–æ–≥–ª–∞—Å–Ω–∞—è",
        "–≥–ª–∞—Å–Ω–∞—è",
        "—Ç–≤–µ—Ä–¥—ã–π",
        "–º—è–≥–∫–∏–π",
        "–∞–ª—Ñ–∞–≤–∏—Ç",
        "–±—É–∫–≤–∞",
        "–∞–∑–±—É–∫–∞",
        "–ø—Ä–∞–≤–∏–ª–æ",
        "–æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è",
        "–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞",
        # === –õ–ò–¢–ï–†–ê–¢–£–†–ê ===
        "–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞",
        "–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ",
        "–∞–≤—Ç–æ—Ä",
        "–ø–æ—ç—Ç",
        "–ø–∏—Å–∞—Ç–µ–ª—å",
        "—Å—Ç–∏—Ö",
        "—Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ",
        "—Ä–∞—Å—Å–∫–∞–∑",
        "—Ä–æ–º–∞–Ω",
        # === –ò–ù–û–°–¢–†–ê–ù–ù–´–ï –Ø–ó–´–ö–ò ===
        "–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫",
        "–Ω–µ–º–µ—Ü–∫–∏–π —è–∑—ã–∫",
        "—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —è–∑—ã–∫",
        "–∏—Å–ø–∞–Ω—Å–∫–∏–π —è–∑—ã–∫",
        "–ø–µ—Ä–µ–≤–µ–¥–∏",
        "–ø–µ—Ä–µ–≤–æ–¥",
        "—Å–ª–æ–≤–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º",
        "—Å–ª–æ–≤–æ –Ω–∞ –Ω–µ–º–µ—Ü–∫–æ–º",
        "—Å–ª–æ–≤–æ –Ω–∞ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º",
        "—Å–ª–æ–≤–æ –Ω–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–º",
        # === –û–ë–©–ï–°–¢–í–û–ó–ù–ê–ù–ò–ï –ò –ü–û–õ–ò–¢–ò–ö–ê (—É—á–µ–±–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç) ===
        "–æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ",
        "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ",
        "–∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è",
        "–ø—Ä–∞–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞",
        "–ø—Ä–∞–≤–∞ —Ä–µ–±–µ–Ω–∫–∞",
        "–≥—Ä–∞–∂–¥–∞–Ω–∏–Ω",
        "–≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ",
        "–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ",
        "–≤–µ—Ç–≤–∏ –≤–ª–∞—Å—Ç–∏",
        "–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–ª–∞—Å—Ç—å",
        "–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω–∞—è –≤–ª–∞—Å—Ç—å",
        "—Å—É–¥–µ–±–Ω–∞—è –≤–ª–∞—Å—Ç—å",
        "–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç",
        "–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ",
        "–ø–∞—Ä–ª–∞–º–µ–Ω—Ç",
        "–¥—É–º–∞",
        "–≤—ã–±–æ—Ä—ã",
        "–¥–µ–º–æ–∫—Ä–∞—Ç–∏—è",
        "–º–æ–Ω–∞—Ä—Ö–∏—è",
        "—Ä–µ—Å–ø—É–±–ª–∏–∫–∞",
        "–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–æ–π",
        "—Ñ–æ—Ä–º–∞ –ø—Ä–∞–≤–ª–µ–Ω–∏—è",
        "—Ñ–µ–¥–µ—Ä–∞—Ü–∏—è",
        "–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞",
        "–ø–æ–ª–∏—Ç–∏–∫–∞",
        "—á—Ç–æ —Ç–∞–∫–æ–µ –ø–æ–ª–∏—Ç–∏–∫–∞",
        "–∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ",
        "–∫—Ç–æ —Ç–∞–∫–æ–π –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç",
        # === –†–ï–õ–ò–ì–ò–û–í–ï–î–ï–ù–ò–ï –ò –û–†–ö–°–≠ (—É—á–µ–±–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç) ===
        "–æ—Ä–∫—Å—ç",
        "–æ—Å–Ω–æ–≤—ã —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä",
        "—Å–≤–µ—Ç—Å–∫–∞—è —ç—Ç–∏–∫–∞",
        "–º–∏—Ä–æ–≤—ã–µ —Ä–µ–ª–∏–≥–∏–∏",
        "—Ä–µ–ª–∏–≥–∏–æ–≤–µ–¥–µ–Ω–∏–µ",
        "–∏—Å—Ç–æ—Ä–∏—è —Ä–µ–ª–∏–≥–∏–π",
        "—Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å—Ç–≤–æ",
        "–∏—Å–ª–∞–º",
        "–±—É–¥–¥–∏–∑–º",
        "–∏—É–¥–∞–∏–∑–º",
        "–ø—Ä–∞–≤–æ—Å–ª–∞–≤–∏–µ",
        "–∫–∞—Ç–æ–ª–∏—Ü–∏–∑–º",
        "–ø—Ä–æ—Ç–µ—Å—Ç–∞–Ω—Ç–∏–∑–º",
        "–±–æ–≥",
        "–∞–ª–ª–∞—Ö",
        "–±—É–¥–¥–∞",
        "–∏–∏—Å—É—Å",
        "–º—É—Ö–∞–º–º–µ–¥",
        "–º–æ–∏—Å–µ–π",
        "—Ü–µ—Ä–∫–æ–≤—å",
        "—Ö—Ä–∞–º",
        "–º–µ—á–µ—Ç—å",
        "—Å–∏–Ω–∞–≥–æ–≥–∞",
        "–±–∏–±–ª–∏—è",
        "–∫–æ—Ä–∞–Ω",
        "—Ç–æ—Ä–∞",
        "—Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏",
        "–ø–∞—Å—Ö–∞",
        "—Ä–æ–∂–¥–µ—Å—Ç–≤–æ",
        "—Ä–∞–º–∞–¥–∞–Ω",
        "—Ö–∞–Ω—É–∫–∞",
        "—á—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–ª–∏–≥–∏—è",
        "–∑–∞—á–µ–º –ª—é–¥–∏ –≤–µ—Ä—è—Ç",
        "–∏—Å—Ç–æ—Ä–∏—è —Ä–µ–ª–∏–≥–∏–∏",
        "–∫—É–ª—å—Ç—É—Ä–∞ –∏ —Ä–µ–ª–∏–≥–∏—è",
        "—Ç—Ä–∞–¥–∏—Ü–∏–∏ –Ω–∞—Ä–æ–¥–æ–≤",
        "–æ–±—ã—á–∞–∏ –Ω–∞—Ä–æ–¥–æ–≤",
        # === –û–ë–©–ò–ï –£–ß–ï–ë–ù–´–ï –ö–û–ù–¢–ï–ö–°–¢–´ ===
        "—É—Ä–æ–∫",
        "–¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ",
        "–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞",
        "—ç–∫–∑–∞–º–µ–Ω",
        "—à–∫–æ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞",
        "—É—á–µ–±–Ω–∏–∫",
        "—É—á–µ–±–∞",
        "–æ–±—É—á–µ–Ω–∏–µ",
        "—à–ø–∞—Ä–≥–∞–ª–∫–∞",
        "–ø–∞–º—è—Ç–∫–∞",
        "—Å–ø—Ä–∞–≤–∫–∞",
        "—Å–æ–∑–¥–∞–π",
        "–Ω–∞–ø–∏—à–∏",
        "–ø–æ–∫–∞–∂–∏",
        "–æ–±—ä—è—Å–Ω–∏",
        "—Ä–∞—Å—Å–∫–∞–∂–∏",
        "–ø–æ–º–æ–≥–∏",
        "—Å–æ—Å—Ç–∞–≤—å",
        "–Ω–∞—Ä–∏—Å—É–π",
        "–ø–æ—Å—Ç—Ä–æ–π",
        "–≤—ã–≤–µ–¥–∏",
        "–æ—Ç–æ–±—Ä–∞–∑–∏",
    ]

    def __init__(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏."""
        # –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Ç–µ–º –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -> –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –≤ –ø—Ä–æ—Å—Ç–æ–π regex –¥–ª—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
        topics: list[str] = settings.get_forbidden_topics_list()
        self._topic_regexes: list[Pattern[str]] = [
            re.compile(rf"{re.escape(topic)}", re.IGNORECASE) for topic in topics
        ]

        # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -> –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–ª–æ–≤
        self._forbidden_regexes: list[Pattern[str]] = [
            re.compile(rf"\b{re.escape(pattern)}\b", re.IGNORECASE)
            for pattern in FORBIDDEN_PATTERNS
        ]

        self.filter_level: int = settings.content_filter_level

        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏
        self.advanced_moderation = AdvancedModerationService()

        # –ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω—ã—Ö —Å–ª–æ–≤ (—Ä—É—Å—Å–∫–∏–π) -> –µ–¥–∏–Ω—ã–π regex —Å word-boundaries
        profanity_words_ru = [
            "–±–ª—è—Ç—å",
            "–±–ª—è",
            "—Ö—É–π",
            "–ø–∏–∑–¥",
            "–µ–±–∞—Ç—å",
            "–µ–±–∞–Ω",
            "—Å—É–∫–∞",
            "–º—É–¥–∞–∫",
            "–¥–µ–±–∏–ª",
            "–∏–¥–∏–æ—Ç",
        ]

        # –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
        profanity_words_en = [
            "fuck",
            "shit",
            "damn",
            "bitch",
            "asshole",
            "bastard",
            "dick",
            "piss",
            "crap",
            "hell",  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å —Ç–æ—á–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º \bhell\b, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å "Hello"
        ]

        # –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞ –Ω–∞ –Ω–µ–º–µ—Ü–∫–æ–º
        profanity_words_de = [
            "schei√üe",
            "scheisse",
            "fick",
            "arsch",
            "hure",
            "mist",
            "verdammt",
            "bl√∂de",
        ]

        # –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞ –Ω–∞ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º
        profanity_words_fr = [
            "merde",
            "putain",
            "salope",
            "connard",
            "con",
            "bordel",
            "encul√©",
        ]

        # –ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞ –Ω–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–º
        profanity_words_es = [
            "joder",
            "puta",
            "co√±o",
            "cabr√≥n",
            "mierda",
            "hostia",
            "hijo de puta",
        ]

        # –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º –≤—Å–µ —Å–ª–æ–≤–∞ –¥–ª—è –µ–¥–∏–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        all_profanity_words = (
            profanity_words_ru
            + profanity_words_en
            + profanity_words_de
            + profanity_words_fr
            + profanity_words_es
        )

        # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è "hell" - —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å "Hello"
        # –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω —Å \w* (–ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è)
        patterns = []
        for word in all_profanity_words:
            if word == "hell":
                # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "hell", —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å "Hello"
                patterns.append(rf"\b{re.escape(word)}\b")
            else:
                # –û–±—ã—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Å –æ–∫–æ–Ω—á–∞–Ω–∏—è–º–∏
                patterns.append(rf"\b{re.escape(word)}\w*\b")

        self._profanity_regex: Pattern[str] = re.compile(
            r"|".join(patterns),
            re.IGNORECASE,
        )

        # SQLi/XSS –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        self._sql_regexes: list[Pattern[str]] = [
            re.compile(r"'\s*OR\s*'1'\s*=\s*'1", re.IGNORECASE),
            re.compile(r";\s*DROP\s+TABLE", re.IGNORECASE),
            re.compile(r"UNION\s+SELECT", re.IGNORECASE),
        ]
        self._xss_regexes: list[Pattern[str]] = [
            re.compile(r"<script.*?>", re.IGNORECASE),
            re.compile(r"javascript:", re.IGNORECASE),
            re.compile(r"on\w+\s*=", re.IGNORECASE),  # onclick=, onerror=
        ]

    def is_provocative_question(self, text: str) -> bool:  # noqa: ARG002
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–º. –û—Ç–∫–ª—é—á–µ–Ω–æ: —Å–≤–æ–±–æ–¥–∞ –º–æ–¥–µ–ª–∏."""
        return False

    def is_safe_content(self, text: str) -> tuple[bool, str | None]:  # noqa: ARG002
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, –±–µ–∑–æ–ø–∞—Å–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç. –û—Ç–∫–ª—é—á–µ–Ω–æ: —Å–≤–æ–±–æ–¥–∞ –º–æ–¥–µ–ª–∏, —Å–∞–º–∞ –∑–Ω–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã."""
        return True, None

    def sanitize_ai_response(self, response: str) -> str:
        """–û—á–∏—Å—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ AI –æ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."""
        is_safe, reason = self.is_safe_content(response)
        if not is_safe:
            logger.error(f"‚ö†Ô∏è AI —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç! –ü—Ä–∏—á–∏–Ω–∞: {reason}")
            return (
                "–ò–∑–≤–∏–Ω–∏, —è –Ω–µ –º–æ–≥—É –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å. " "–î–∞–≤–∞–π –ª—É—á—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± —É—á—ë–±–µ! üìö"
            )
        return response

    def get_safe_response_alternative(self, detected_topic: str = "") -> str:  # noqa: ARG002
        """–ü–æ–ª—É—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ."""
        alternatives = [
            "–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –ª—É—á—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± —É—á—ë–±–µ! üìö –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
            "–û–π, –¥–∞–≤–∞–π –ª—É—á—à–µ –æ–±—Å—É–¥–∏–º —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –∏–∑ —à–∫–æ–ª—ã! ‚ú® –ö–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?",
            "–•–º, –¥–∞–≤–∞–π –ª—É—á—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —á—ë–º-—Ç–æ –ø–æ–ª–µ–∑–Ω–æ–º –¥–ª—è —É—á—ë–±—ã! üéì –ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —É—Ä–æ–∫–∞–º?",
            "–î–∞–≤–∞–π –ª—É—á—à–µ –æ–±—Å—É–¥–∏–º —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ! üìñ –ö–∞–∫–æ–π –ø—Ä–µ–¥–º–µ—Ç –∏–∑—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è?",
            "–û, –∞ –¥–∞–≤–∞–π –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± —É—á—ë–±–µ! üêº –ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —à–∫–æ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º?",
            "–î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –∏–∑ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã! –Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º üòä",
            "–ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ —Å —É—á–µ–±–æ–π! üìö –ß—Ç–æ –∏–∑—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è?",
        ]
        return secrets.choice(alternatives)

    async def _save_moderation_log(self, telegram_id: int, content: str, reason: str) -> None:
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
        try:
            from datetime import datetime

            from sqlalchemy import select

            from bot.database import get_db
            from bot.models import User

            # get_db() - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π context manager, –Ω–µ async
            with get_db() as db:
                # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                stmt = select(User).where(User.telegram_id == telegram_id)
                user_obj = db.execute(stmt).scalar_one_or_none()

                if user_obj:
                    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É moderation_log –≤ –±—É–¥—É—â–µ–º
                    # –ü–æ–∫–∞ –ª–æ–≥–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–≥–µ—Ä
                    logger.info(
                        "MODERATION_LOG | User: %s | Reason: %s | Content: %s | Time: %s",
                        telegram_id,
                        reason,
                        content[:100] + "..." if len(content) > 100 else content,
                        datetime.utcnow().isoformat(),
                    )
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏: {e}")

    def log_blocked_content(self, telegram_id: int, message: str, reason: str) -> None:
        """
        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
        """
        logger.warning(
            "üö´ BLOCKED CONTENT | User: %s | Reason: %s | Message: %s",
            telegram_id,
            reason,
            message[:100] + "...",
        )
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É moderation_log (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –ª–æ–≥–≥–µ—Ä)
        # –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

    async def advanced_moderate_content(
        self, content: str, user_context: dict[str, Any] = None
    ) -> ModerationResult:
        """–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ML."""
        return await self.advanced_moderation.moderate_content(content, user_context)

    async def get_moderation_stats(self) -> dict[str, Any]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏"""
        return await self.advanced_moderation.get_moderation_stats()
