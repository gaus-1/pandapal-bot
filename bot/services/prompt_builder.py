"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è YandexGPT.

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—Ä–æ—â–∞–Ω–∏—è
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç
- –û–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏
"""

from bot.config.prompts import AI_SYSTEM_PROMPT


class PromptBuilder:
    """–ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è YandexGPT."""

    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤."""
        self.base_prompt = AI_SYSTEM_PROMPT

    def build_system_prompt(
        self,
        user_age: int | None = None,
        user_name: str | None = None,
        user_message_count: int = 0,
        is_history_cleared: bool = False,
        history: list[dict] | None = None,
        user_message: str = "",
        web_context: str = "",
        non_educational_count: int = 0,
    ) -> str:
        """
        –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

        Args:
            user_age: –í–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_name: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_message_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ –∏–º–µ–Ω–∏
            is_history_cleared: –ë—ã–ª–∞ –ª–∏ –æ—á–∏—â–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è
            history: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
            user_message: –¢–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            web_context: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ–±-–∫–æ–Ω—Ç–µ–∫—Å—Ç
            non_educational_count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–µ–¥–º–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥

        Returns:
            str: –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        """
        prompt = self.base_prompt

        # –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç
        if user_age:
            prompt += f"\n\n–í–∞–∂–Ω–æ: –ê–¥–∞–ø—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç –ø–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ({user_age} –ª–µ—Ç)."

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        greeting_state = self._determine_greeting_state(
            history=history,
            is_history_cleared=is_history_cleared,
            user_message=user_message,
        )

        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—é/–ø—Ä–æ—â–∞–Ω–∏—é
        prompt += self._build_greeting_instructions(greeting_state)

        # –û–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏
        if user_name and user_message_count >= 5:
            import random

            should_use_name = (
                user_message_count >= 5 and user_message_count <= 10 and random.random() < 0.5
            )
            if should_use_name:
                prompt += (
                    f"\n\n–í–ê–ñ–ù–û: –û–±—Ä–∞—Ç–∏—Å—å –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –∏–º–µ–Ω–∏ '{user_name}' –≤ –Ω–∞—á–∞–ª–µ –æ—Ç–≤–µ—Ç–∞. "
                    f"–ò—Å–ø–æ–ª—å–∑—É–π –∏–º—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä: '{user_name}, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ!' –∏–ª–∏ "
                    f"'–ü–æ–Ω—è–ª, {user_name}! –°–µ–π—á–∞—Å –æ–±—ä—è—Å–Ω—é...' "
                    f"–ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π - –æ–±—Ä–∞—â–∞–π—Å—è –ø–æ –∏–º–µ–Ω–∏ —Ç–æ–ª—å–∫–æ –∏–Ω–æ–≥–¥–∞, –Ω–µ –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ!"
                )

        # –ó–∞–ø—Ä–æ—Å –∏–º–µ–Ω–∏ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∏—Å—Ç–æ—Ä–∏–∏
        if is_history_cleared and not user_name:
            prompt += self._build_name_request_instructions()

        # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—á–µ–±—É
        if non_educational_count >= 2:
            prompt += (
                f"\n\nüö´ –í–ê–ñ–ù–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª —É–∂–µ {non_educational_count} –Ω–µ–ø—Ä–µ–¥–º–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä—è–¥. "
                "–í–µ–∂–ª–∏–≤–æ, –Ω–æ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å –µ–≥–æ –Ω–∞ —É—á–µ–±—É. "
                "–°–∫–∞–∂–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –æ–±—â–∞—Ç—å—Å—è, –Ω–æ –¥–∞–≤–∞–π –ª—É—á—à–µ –≤–µ—Ä–Ω–µ–º—Å—è –∫ —É—á–µ–±–µ! "
                "–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ —à–∫–æ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º? –Ø –ø–æ–º–æ–≥—É —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π, —Ä—É—Å—Å–∫–∏–º, –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –º–Ω–æ–≥–∏–º –¥—Ä—É–≥–∏–º! üìö'"
            )

        # –í–µ–±-–∫–æ–Ω—Ç–µ–∫—Å—Ç
        if web_context:
            prompt += f"\n\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n{web_context}"

        return prompt

    def _determine_greeting_state(
        self,
        history: list[dict] | None,
        is_history_cleared: bool,
        user_message: str,
    ) -> dict:
        """
        –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.

        Returns:
            dict: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å –∫–ª—é—á–∞–º–∏:
                - ai_already_greeted: bool
                - user_greeted: bool
                - user_farewelled: bool
                - should_greet: bool
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç –ø–∞–Ω–¥—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏
        ai_already_greeted = False
        if history:
            for msg in history:
                if msg.get("role") in ("assistant", "ai"):
                    msg_text = msg.get("text", "").lower()
                    if "–ø—Ä–∏–≤–µ—Ç" in msg_text or "—á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å" in msg_text:
                        ai_already_greeted = True
                        break

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        user_message_lower = user_message.lower().strip()
        greeting_words = [
            "–ø—Ä–∏–≤–µ—Ç",
            "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π",
            "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ",
            "–¥–æ–±—Ä—ã–π –¥–µ–Ω—å",
            "–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä",
            "–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ",
            "–∑–¥–∞—Ä–æ–≤–∞",
            "—Ö–∞–π",
            "hi",
            "hello",
        ]
        user_greeted = any(greeting in user_message_lower for greeting in greeting_words)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—â–∞–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        farewell_words = [
            "–ø–æ–∫–∞",
            "–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è",
            "–¥–æ —Å–≤–∏–¥–∞–Ω—å—è",
            "–ø—Ä–æ—â–∞–π",
            "–ø—Ä–æ—â–∞–π—Ç–µ",
            "—É–≤–∏–¥–∏–º—Å—è",
            "–¥–æ –≤—Å—Ç—Ä–µ—á–∏",
            "–¥–æ –∑–∞–≤—Ç—Ä–∞",
            "–¥–æ —Å–∫–æ—Ä–æ–≥–æ",
            "–¥–æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–∏",
            "–≤—Å–µ–≥–æ –¥–æ–±—Ä–æ–≥–æ",
            "–≤—Å–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ",
            "—É–¥–∞—á–∏",
            "bye",
            "goodbye",
            "see you",
            "see ya",
            "farewell",
        ]
        user_farewelled = any(farewell in user_message_lower for farewell in farewell_words)

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
        should_greet = (
            ((not history) or is_history_cleared or user_greeted)
            and not ai_already_greeted
            and not user_farewelled
        )

        return {
            "ai_already_greeted": ai_already_greeted,
            "user_greeted": user_greeted,
            "user_farewelled": user_farewelled,
            "should_greet": should_greet,
        }

    def _build_greeting_instructions(self, state: dict) -> str:
        """
        –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—é/–ø—Ä–æ—â–∞–Ω–∏—é.

        Args:
            state: –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏–∑ _determine_greeting_state

        Returns:
            str: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
        """
        instructions = ""

        if state["should_greet"]:
            instructions += (
                "\n\nüëã –ü–†–ò–í–ï–¢–°–¢–í–ò–ï: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª—Å—è –∏–ª–∏ —ç—Ç–æ –Ω–∞—á–∞–ª–æ –¥–∏–∞–ª–æ–≥–∞. "
                "–ü–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –µ–≥–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –û–î–ò–ù –†–ê–ó. "
                "–ù–ï –ø–æ–≤—Ç–æ—Ä—è–π '–ü—Ä–∏–≤–µ—Ç' –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö!"
            )
        elif state["ai_already_greeted"]:
            instructions += (
                "\n\nüö´üö´üö´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–∞–Ω–¥–∞ –£–ñ–ï –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª–∞—Å—å —Ä–∞–Ω–µ–µ. "
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è, –Ω–æ —Ç—ã –£–ñ–ï –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª–∞—Å—å - –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–ü—Ä–∏–≤–µ—Ç' –≤ –Ω–∞—á–∞–ª–µ –æ—Ç–≤–µ—Ç–∞!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–Ø —Ä–∞–¥ –ø–æ–º–æ—á—å —Ç–µ–±–µ'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–†–∞–¥ –ø–æ–º–æ—á—å'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –ø–æ–º–æ–≥—É'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–≥—É'!\n"
                "‚úÖ –û–¢–í–ï–ß–ê–ô –°–†–ê–ó–£ –ü–û –î–ï–õ–£ –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!\n"
                "‚úÖ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –ø–æ–∑–¥–æ—Ä–æ–≤–∞–ª—Å—è - –æ—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ –∏ —Å–ø—Ä–æ—Å–∏ —á–µ–º –ø–æ–º–æ—á—å, –ë–ï–ó –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è '–ü—Ä–∏–≤–µ—Ç'!\n"
                "‚úÖ –û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ú (–Ω–µ –ø–æ–ª–æ—Ç–Ω–æ —Ç–µ–∫—Å—Ç–∞)!\n"
                "‚úÖ –í –ö–û–ù–¶–ï –û–¢–í–ï–¢–ê –°–ü–†–û–°–ò: '–ü–æ–Ω—è—Ç–Ω–æ? –ò–ª–∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?'"
            )
        else:
            instructions += (
                "\n\nüö´üö´üö´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –í–û–ü–†–û–° (—Ç–µ–∫—Å—Ç–æ–º, –∞—É–¥–∏–æ –∏–ª–∏ —Ñ–æ—Ç–æ) - –û–¢–í–ï–ß–ê–ô –°–†–ê–ó–£ –ü–û –î–ï–õ–£!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–ü—Ä–∏–≤–µ—Ç' –≤ –Ω–∞—á–∞–ª–µ –æ—Ç–≤–µ—Ç–∞!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–Ø —Ä–∞–¥ –ø–æ–º–æ—á—å —Ç–µ–±–µ'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–†–∞–¥ –ø–æ–º–æ—á—å'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –ø–æ–º–æ–≥—É'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–ö–æ–Ω–µ—á–Ω–æ, –ø–æ–º–æ–≥—É'!\n"
                "‚ùå –ù–ï –≥–æ–≤–æ—Ä–∏ '–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º' –≤ –Ω–∞—á–∞–ª–µ!\n"
                "‚úÖ –ù–ê–ß–ò–ù–ê–ô –û–¢–í–ï–¢ –°–†–ê–ó–£ –° –†–ï–®–ï–ù–ò–Ø –ó–ê–î–ê–ß–ò –ò–õ–ò –û–ë–™–Ø–°–ù–ï–ù–ò–Ø!\n"
                "‚úÖ –û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ú (–Ω–µ –ø–æ–ª–æ—Ç–Ω–æ —Ç–µ–∫—Å—Ç–∞)!\n"
                "‚úÖ –í –ö–û–ù–¶–ï –û–¢–í–ï–¢–ê –°–ü–†–û–°–ò: '–ü–æ–Ω—è—Ç–Ω–æ? –ò–ª–∏ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ?'"
            )

        # –ü—Ä–æ—â–∞–Ω–∏–µ
        if state["user_farewelled"]:
            instructions += (
                "\n\nüëã –ü–†–û–©–ê–ù–ò–ï: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—â–∞–µ—Ç—Å—è. "
                "–ü–æ–ø—Ä–æ—â–∞–π—Å—è —Å –Ω–∏–º –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –û–î–ò–ù –†–ê–ó: '–ü–æ–∫–∞! –£–¥–∞—á–∏ –≤ —É—á—ë–±–µ! üêº' –∏–ª–∏ "
                "'–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –ï—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã - –æ–±—Ä–∞—â–∞–π—Å—è! üìö' –∏–ª–∏ "
                "'–ü–æ–∫–∞! –ñ–µ–ª–∞—é —É—Å–ø–µ—Ö–æ–≤! ‚ú®' "
                "–ù–ï –≥–æ–≤–æ—Ä–∏ '–ü—Ä–∏–≤–µ—Ç' –≤ –æ—Ç–≤–µ—Ç–µ –Ω–∞ –ø—Ä–æ—â–∞–Ω–∏–µ! "
                "–ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –ø—Ä–æ—â–∞–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö!"
            )

        return instructions

    def _build_name_request_instructions(self) -> str:
        """–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ–Ω–∏."""
        return (
            "\n\nüö´üö´üö´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –±—ã–ª–∞ –æ—á–∏—â–µ–Ω–∞. "
            "–í –Ω–∞—á–∞–ª–µ –æ—Ç–≤–µ—Ç–∞ –ü–û–ü–†–û–°–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–∑–≤–∞—Ç—å —Å–≤–æ—ë –∏–º—è, "
            "—á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–µ–º—É –ø–æ –∏–º–µ–Ω–∏ –≤ –±—É–¥—É—â–µ–º. "
            "–ù–∞–ø—Ä–∏–º–µ—Ä: '–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? üêº' "
            "–∏–ª–∏ '–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç PandaPal. –ê –∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?'\n\n"
            "‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ü–†–û–í–ï–†–ö–ê –ò–ú–ï–ù–ò:\n"
            "–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ, –¢–´ –î–û–õ–ñ–ï–ù –ü–†–û–í–ï–†–ò–¢–¨ —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ò–ú–Ø:\n"
            "‚ùå –ù–ï —è–≤–ª—è–µ—Ç—Å—è –∏–º–µ–Ω–µ–º: '–¥–∞', '–Ω–µ—Ç', '–æ–∫', '—Ö–æ—Ä–æ—à–æ', '—Å–ø–∞—Å–∏–±–æ', '–ø—Ä–∏–≤–µ—Ç', '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–∑–∞–¥–∞—á–∞', '–ø–æ–º–æ–≥–∏', '—Ä–µ—à–∏', "
            "–ª—é–±—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª–∏–Ω–Ω–µ–µ 20 —Å–∏–º–≤–æ–ª–æ–≤, —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—ã –∏–ª–∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (–∫—Ä–æ–º–µ –¥–µ—Ñ–∏—Å–∞), –æ–±—ã—á–Ω—ã–µ —Å–ª–æ–≤–∞, –≤–æ–ø—Ä–æ—Å—ã, —Ñ—Ä–∞–∑—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.\n"
            "‚úÖ –Ø–í–õ–Ø–ï–¢–°–Ø –∏–º–µ–Ω–µ–º: –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–ª–æ–≤–æ 2-15 —Å–∏–º–≤–æ–ª–æ–≤, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã (—Ä—É—Å—Å–∫–∏–µ, –ª–∞—Ç–∏–Ω—Å–∫–∏–µ) –∏ –¥–µ—Ñ–∏—Å, –ù–ï —è–≤–ª—è–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º —Å–ª–æ–≤–æ–º.\n"
            "–ü—Ä–∏–º–µ—Ä—ã –∏–º–µ–Ω: –°–∞—à–∞, –ú–∞—à–∞, –î–∞–Ω–∏–ª, –ê—Ä—Ç—ë–º, –ê–Ω–∞—Å—Ç–∞—Å–∏—è, –ú–∞–∫—Å–∏–º, –í–∏–∫—Ç–æ—Ä–∏—è.\n\n"
            "‚ö†Ô∏è –ï–°–õ–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ù–ê–ü–ò–°–ê–õ –ï–†–£–ù–î–£ –í–ú–ï–°–¢–û –ò–ú–ï–ù–ò:\n"
            "–¢—ã –î–û–õ–ñ–ï–ù —ç—Ç–æ –ü–û–ù–Ø–¢–¨ –∏ –í–ï–ñ–õ–ò–í–û –ü–ï–†–ï–°–ü–†–û–°–ò–¢–¨:\n"
            "'–•–º, —ç—Ç–æ –Ω–µ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ –∏–º—è. –ú–æ–∂–µ—à—å –Ω–∞–∑–≤–∞—Ç—å —Å–≤–æ—ë –Ω–∞—Å—Ç–æ—è—â–µ–µ –∏–º—è? –ù–∞–ø—Ä–∏–º–µ—Ä: –°–∞—à–∞, –ú–∞—à–∞, –î–∞–Ω–∏–ª –∏ —Ç.–¥. "
            "–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å - —Å–∫–∞–∂–∏, –∏ —è –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å! üòä'\n\n"
            "–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑—ã–≤–∞—Ç—å –∏–º—è (–ø–∏—à–µ—Ç '–Ω–µ —Ö–æ—á—É', '–Ω–µ —Å–∫–∞–∂—É', '–Ω–µ –±—É–¥—É' –∏ —Ç.–¥.), "
            "–≤–µ–∂–ª–∏–≤–æ —Å–∫–∞–∂–∏ —á—Ç–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ –±–æ–ª—å—à–µ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–π –æ–± –∏–º–µ–Ω–∏."
        )


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
_prompt_builder = None


def get_prompt_builder() -> PromptBuilder:
    """–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä PromptBuilder."""
    global _prompt_builder
    if _prompt_builder is None:
        _prompt_builder = PromptBuilder()
    return _prompt_builder
