# Config - Конфигурация

Настройки приложения, промпты для YandexGPT и паттерны модерации.

## Файлы

- `settings.py` - настройки из переменных окружения (Pydantic Settings)
- `prompts.py` — системные промпты для YandexGPT, определяют поведение бота
- `response_rules.py` — единый источник: триггеры визуализации (когда показывать график), сниппет правил оформления для ДЗ
- `forbidden_patterns.py` - паттерны для модерации контента

## Settings

Настройки загружаются из `.env` через Pydantic. Это удобно - все в одном месте:

```python
from bot.config.settings import settings

database_url = settings.database_url
telegram_token = settings.telegram_bot_token
```

Все настройки валидируются при старте - если что-то не так, приложение не запустится. Это защищает от ошибок конфигурации.

### Параметры генерации (актуальные)
- **Модель**: `yandexgpt/latest` (YandexGPT Pro для всех пользователей)
- **Temperature**: `0.3` (баланс точности и естественности)
- **Max tokens**: `2000` (рекомендуется для Pro модели)
- **Лимиты**: 30 запросов/месяц (free), 500/день (month), без ограничений (year)

## Промпты

Системные промпты определяют поведение бота:
- Как бот общается с детьми (естественно, по-человечески)
- Адаптация под возраст (1-9 классы, 6-15 лет)
- Какие предметы поддерживает (все школьные)
- Что запрещено говорить (политика, насилие, 18+)
- **Логика приветствий**: "Привет" только один раз, не в ответах на задачи
- **Логика прощаний**: "Пока" только после явного прощания пользователя
- **Структурированные ответы**: абзацы, списки (- или 1. 2. 3.), подзаголовки **Тема:**, жирный для терминов (см. prompts.py)
- **Запрет повторов**: AI не должен повторять одни и те же фразы
- Перенаправление на учебу при необразовательных вопросах

Менять промпты нужно аккуратно - они сильно влияют на поведение бота. Промпты основаны на рекомендациях Yandex Cloud для лучших практик.

## Паттерны модерации

Паттерны для фильтрации опасного контента:
- Запрещенные слова и фразы
- Паттерны для разных языков (RU, EN, DE, FR, ES)
- Категории контента (насилие, наркотики и т.д.)

Эти паттерны критически важны для безопасности детей.

## Важно

- Никогда не коммить секреты - все секреты только в `.env`
- Проверяй настройки при старте - если что-то не так, лучше упасть сразу
- Промпты можно менять - но тестируй изменения перед деплоем
