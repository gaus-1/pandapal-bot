# Bot - Backend логика

Здесь живет вся логика Telegram-бота. Обработчики команд, бизнес-логика, API для Mini App и все настройки.

## Что внутри

```
bot/
├── handlers/      # Обработчики команд - что бот делает когда пользователь пишет
├── services/       # Вся бизнес-логика - AI, платежи, игры, модерация
├── api/           # HTTP endpoints для Mini App и внешних сервисов
├── config/         # Настройки, промпты для AI, паттерны модерации
├── security/       # Защита - middleware, валидация, rate limiting
├── keyboards/      # Клавиатуры для Telegram (кнопки в боте)
├── localization/   # Переводы интерфейса (ru, en)
├── monitoring/     # Мониторинг - метрики, логи, ошибки
├── models.py       # Модели БД - как данные хранятся
└── database.py     # Подключение к PostgreSQL
```

## Как это работает

**Handlers** - реагируют на команды и сообщения пользователей. Когда кто-то пишет `/start` или отправляет фото, срабатывает соответствующий handler.

**Services** - вся логика приложения. Здесь AI генерирует ответы, модерация проверяет контент, платежи обрабатываются, игры работают.

**API** - HTTP endpoints для Mini App. Когда пользователь открывает приложение в Telegram, оно обращается к этим endpoints.

**Security** - защита от атак, валидация данных, ограничение запросов. Критически важно для безопасности детей.

## Работа с БД

Всегда используй context manager для работы с базой:

```python
from bot.database import get_db
from bot.models import User

with get_db() as db:
    user = db.query(User).filter_by(telegram_id=123).first()
    # Делаем что-то с пользователем
```

Не забывай закрывать соединения - context manager делает это автоматически.

## Логирование

Используем loguru - удобно и красиво:

```python
from loguru import logger

logger.info("Пользователь отправил сообщение")
logger.error("Ошибка при обработке", exc_info=True)
```

Логи помогают понять что происходит в продакшене, когда что-то идет не так.
