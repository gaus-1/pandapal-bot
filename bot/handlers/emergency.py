"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –¥–µ—Ç–µ–π.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤–∞–∂–Ω—ã–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º:
- –ü–æ–∂–∞—Ä–Ω—ã–µ, —Å–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å, –ø–æ–ª–∏—Ü–∏—è
- –ï–¥–∏–Ω—ã–π –Ω–æ–º–µ—Ä —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–±
- –¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è –¥–ª—è –¥–µ—Ç–µ–π
"""

from aiogram import Router
from aiogram.filters import Command
from aiogram.types import CallbackQuery, InlineKeyboardButton, InlineKeyboardMarkup, Message
from loguru import logger

router = Router(name="emergency")


def get_emergency_keyboard() -> InlineKeyboardMarkup:
    """
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –†–æ—Å—Å–∏–∏.

    –í—Å–µ –Ω–æ–º–µ—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.
    """
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="üö® 112 - –ï–¥–∏–Ω–∞—è —Å–ª—É–∂–±–∞", callback_data="emergency_112")],
            [
                InlineKeyboardButton(text="üöí 101 - –ü–æ–∂–∞—Ä–Ω—ã–µ", callback_data="emergency_101"),
                InlineKeyboardButton(text="üëÆ 102 - –ü–æ–ª–∏—Ü–∏—è", callback_data="emergency_102"),
            ],
            [
                InlineKeyboardButton(text="üöë 103 - –°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å", callback_data="emergency_103"),
                InlineKeyboardButton(text="üö® 104 - –ì–∞–∑–æ–≤–∞—è —Å–ª—É–∂–±–∞", callback_data="emergency_104"),
            ],
            [
                InlineKeyboardButton(
                    text="üíô –î–µ—Ç—Å–∫–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è", callback_data="emergency_child"
                )
            ],
            [InlineKeyboardButton(text="‚ùå –ó–∞–∫—Ä—ã—Ç—å", callback_data="emergency_close")],
        ]
    )
    return keyboard


EMERGENCY_INFO = {
    "emergency_112": (
        "üö® **112 - –ï–¥–∏–Ω–∞—è —Å–ª—É–∂–±–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤**\n\n"
        "üìû **–†–∞–±–æ—Ç–∞–µ—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ**\n"
        "üåç **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏**\n"
        "üì± **–î–∞–∂–µ –±–µ–∑ SIM-–∫–∞—Ä—Ç—ã**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –ü–æ–∂–∞—Ä, –∞–≤–∞—Ä–∏—è, –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ\n"
        "‚Ä¢ –ù—É–∂–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å\n"
        "‚Ä¢ –õ—é–±–∞—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è\n\n"
        "‚ú® **–û–ø–µ—Ä–∞—Ç–æ—Ä —Å–∞–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç –Ω–∞ –Ω—É–∂–Ω—É—é —Å–ª—É–∂–±—É!**"
    ),
    "emergency_101": (
        "üöí **101 - –ü–æ–∂–∞—Ä–Ω–∞—è —Å–ª—É–∂–±–∞ –ú–ß–°**\n\n"
        "üìû **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –ü–æ–∂–∞—Ä (–¥—ã–º, –æ–≥–æ–Ω—å, –∑–∞–ø–∞—Ö –≥–∞—Ä–∏)\n"
        "‚Ä¢ –õ—é–¥–∏ –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ –ù—É–∂–Ω–∞ —ç–≤–∞–∫—É–∞—Ü–∏—è\n\n"
        "‚ö†Ô∏è **–ù–µ –ø–∞–Ω–∏–∫—É–π! –ù–∞–∑–æ–≤–∏ –∞–¥—Ä–µ—Å —á–µ—Ç–∫–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ.**"
    ),
    "emergency_102": (
        "üëÆ **102 - –ü–æ–ª–∏—Ü–∏—è**\n\n"
        "üìû **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ (–∫—Ä–∞–∂–∞, –¥—Ä–∞–∫–∞, —É–≥—Ä–æ–∑–∞)\n"
        "‚Ä¢ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ª—é–¥–∏\n"
        "‚Ä¢ –¢—ã –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ –ü–æ—Ç–µ—Ä—è–ª—Å—è\n\n"
        "‚úÖ **–ü–æ–ª–∏—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –∏ –∑–∞—â–∏—Ç–∏—Ç!**"
    ),
    "emergency_103": (
        "üöë **103 - –°–∫–æ—Ä–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å**\n\n"
        "üìû **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –ö—Ç–æ-—Ç–æ –±–µ–∑ —Å–æ–∑–Ω–∞–Ω–∏—è\n"
        "‚Ä¢ –°–∏–ª—å–Ω–∞—è –±–æ–ª—å, —Ç—Ä–∞–≤–º–∞, –∫—Ä–æ–≤—å\n"
        "‚Ä¢ –û—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ\n"
        "‚Ä¢ –í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É –º–∞–ª—ã—à–∞\n\n"
        "ü©∫ **–û–ø–∏—à–∏ —Å–∏–º–ø—Ç–æ–º—ã - –≤—Ä–∞—á–∏ –ø—Ä–∏–µ–¥—É—Ç –±—ã—Å—Ç—Ä–æ!**"
    ),
    "emergency_104": (
        "üö® **104 - –ê–≤–∞—Ä–∏–π–Ω–∞—è –≥–∞–∑–æ–≤–∞—è —Å–ª—É–∂–±–∞**\n\n"
        "üìû **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –ó–∞–ø–∞—Ö –≥–∞–∑–∞ –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ/–ø–æ–¥—ä–µ–∑–¥–µ\n"
        "‚Ä¢ –£—Ç–µ—á–∫–∞ –≥–∞–∑–∞\n"
        "‚Ä¢ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–∞–∑–æ–≤–∞—è –ø–ª–∏—Ç–∞\n\n"
        "‚ö†Ô∏è **–ù–ï –í–ö–õ–Æ–ß–ê–ô —Å–≤–µ—Ç –∏ —ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–∏–±–æ—Ä—ã!**\n"
        "‚ö†Ô∏è **–û—Ç–∫—Ä–æ–π –æ–∫–Ω–∞ –∏ –≤—ã–π–¥–∏ –∏–∑ –∫–≤–∞—Ä—Ç–∏—Ä—ã!**"
    ),
    "emergency_child": (
        "üíô **8-800-2000-122 - –î–µ—Ç—Å–∫–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è**\n\n"
        "üìû **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –∞–Ω–æ–Ω–∏–º–Ω–æ**\n\n"
        "–ó–≤–æ–Ω–∏, –µ—Å–ª–∏:\n"
        "‚Ä¢ –¢–µ–±—è –æ–±–∏–∂–∞—é—Ç (–¥–æ–º–∞, –≤ —à–∫–æ–ª–µ, –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ)\n"
        "‚Ä¢ –ì—Ä—É—Å—Ç–Ω–æ, —Å—Ç—Ä–∞—à–Ω–æ, –æ–¥–∏–Ω–æ–∫–æ\n"
        "‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å —É—á–µ–±–æ–π –∏–ª–∏ –¥—Ä—É–∑—å—è–º–∏\n"
        "‚Ä¢ –ù—É–∂–µ–Ω —Å–æ–≤–µ—Ç –≤–∑—Ä–æ—Å–ª–æ–≥–æ\n\n"
        "üí¨ **–¢–µ–±—è –≤—ã—Å–ª—É—à–∞—é—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç! –≠—Ç–æ –ë–ï–ó–û–ü–ê–°–ù–û.**\n"
        "üîí **–ù–∏–∫—Ç–æ –Ω–µ —É–∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç—ã –∑–≤–æ–Ω–∏–ª.**"
    ),
}


@router.message(Command("emergency", "help_emergency", "sos"))
async def cmd_emergency(message: Message):
    """
    –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞.

    –ö–æ–º–∞–Ω–¥—ã: /emergency, /help_emergency, /sos
    """
    logger.info(f"User {message.from_user.id} –æ—Ç–∫—Ä—ã–ª —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞")

    text = (
        "üö® **–≠–ö–°–¢–†–ï–ù–ù–´–ï –ù–û–ú–ï–†–ê –†–û–°–°–ò–ò**\n\n"
        "‚ö° **–í –û–ü–ê–°–ù–û–°–¢–ò? –ó–í–û–ù–ò –°–†–ê–ó–£!**\n\n"
        "–í—ã–±–µ—Ä–∏ –Ω–æ–º–µ—Ä, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ üëá\n\n"
        "üí° **–í—Å–µ –∑–≤–æ–Ω–∫–∏ –ë–ï–°–ü–õ–ê–¢–ù–´–ï!**"
    )

    await message.answer(text, reply_markup=get_emergency_keyboard(), parse_mode="Markdown")


@router.callback_query(lambda c: c.data.startswith("emergency_"))
async def process_emergency_callback(callback: CallbackQuery):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤.
    """
    action = callback.data

    if action == "emergency_close":
        await callback.message.delete()
        await callback.answer("–ó–∞–∫—Ä—ã—Ç–æ")
        return

    if action in EMERGENCY_INFO:
        text = EMERGENCY_INFO[action]

        # –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
        back_keyboard = InlineKeyboardMarkup(
            inline_keyboard=[
                [InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É", callback_data="emergency_back")],
                [InlineKeyboardButton(text="‚ùå –ó–∞–∫—Ä—ã—Ç—å", callback_data="emergency_close")],
            ]
        )

        await callback.message.edit_text(text, reply_markup=back_keyboard, parse_mode="Markdown")
        await callback.answer()

    elif action == "emergency_back":
        text = (
            "üö® **–≠–ö–°–¢–†–ï–ù–ù–´–ï –ù–û–ú–ï–†–ê –†–û–°–°–ò–ò**\n\n"
            "‚ö° **–í –û–ü–ê–°–ù–û–°–¢–ò? –ó–í–û–ù–ò –°–†–ê–ó–£!**\n\n"
            "–í—ã–±–µ—Ä–∏ –Ω–æ–º–µ—Ä, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ üëá\n\n"
            "üí° **–í—Å–µ –∑–≤–æ–Ω–∫–∏ –ë–ï–°–ü–õ–ê–¢–ù–´–ï!**"
        )
        await callback.message.edit_text(
            text, reply_markup=get_emergency_keyboard(), parse_mode="Markdown"
        )
        await callback.answer()
