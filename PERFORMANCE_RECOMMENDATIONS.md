# ‚ö° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ **–≤—ã–¥–µ—Ä–∂–∏—Ç**, –Ω–æ —Å **–∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 5-15 —Å–µ–∫—É–Ω–¥** –¥–ª—è –º–µ–¥–∏–∞ –∏ —Ä–∏—Å–∫–æ–º —Ç–∞–π–º–∞—É—Ç–æ–≤.

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ **2-5 —Å–µ–∫—É–Ω–¥** –¥–ª—è –º–µ–¥–∏–∞, **1-3 —Å–µ–∫** –¥–ª—è —Ç–µ–∫—Å—Ç–∞.

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—É–ª –ë–î –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω (5-20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –¢–æ–ª—å–∫–æ 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚Üí –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è
- –ó–∞–¥–µ—Ä–∂–∫–∏ 1-5 —Å–µ–∫—É–Ω–¥

**–†–µ—à–µ–Ω–∏–µ:**
```python
# bot/database.py
pool_kwargs = {
    "pool_size": 20,        # –ë—ã–ª–æ: 5
    "max_overflow": 30,    # –ë—ã–ª–æ: 15
    "pool_timeout": 60,     # –ë—ã–ª–æ: 30
}
# –ò—Ç–æ–≥–æ: 50 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
```

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç event loop

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `requests.post()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç event loop ‚Üí –º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –º–µ–¥–∏–∞ (SpeechKit, Vision)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ó–∞–º–µ–Ω–∏—Ç—å requests –Ω–∞ httpx (async)
# bot/services/yandex_cloud_service.py

import httpx

async def generate_text_response(...):
    async with httpx.AsyncClient(timeout=30.0) as client:
        response = await client.post(self.gpt_url, headers=..., json=...)
        return response.json()
```

### 3. –ù–µ—Ç –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ YandexGPT
- –†–∏—Å–∫ rate limiting –æ—Ç Yandex Cloud
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤
from asyncio import Semaphore

class AIRequestQueue:
    def __init__(self, max_concurrent: int = 10):
        self.semaphore = Semaphore(max_concurrent)

    async def process(self, func, *args, **kwargs):
        async with self.semaphore:
            return await func(*args, **kwargs)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
ai_queue = AIRequestQueue(max_concurrent=10)
response = await ai_queue.process(ai_service.generate_response, ...)
```

---

## üìä –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π)

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ó–∞–¥–µ—Ä–∂–∫–∞ | –°—Ç–∞—Ç—É—Å |
|------------|---------------|----------|--------|
| –¢–µ–∫—Å—Ç | 50 | 1-3 —Å–µ–∫ | ‚úÖ OK |
| –§–æ—Ç–æ | 30 | 5-10 —Å–µ–∫ | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ |
| –ê—É–¥–∏–æ | 20 | 5-15 —Å–µ–∫ | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è –í—ã–¥–µ—Ä–∂–∏—Ç, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | –ó–∞–¥–µ—Ä–∂–∫–∞ | –°—Ç–∞—Ç—É—Å |
|------------|---------------|----------|--------|
| –¢–µ–∫—Å—Ç | 50 | 1-2 —Å–µ–∫ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| –§–æ—Ç–æ | 30 | 2-5 —Å–µ–∫ | ‚úÖ –•–æ—Ä–æ—à–æ |
| –ê—É–¥–∏–æ | 20 | 3-7 —Å–µ–∫ | ‚úÖ –ü—Ä–∏–µ–º–ª–µ–º–æ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

---

## üöÄ –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. ‚úÖ **–£–≤–µ–ª–∏—á–∏—Ç—å –ø—É–ª –ë–î –¥–æ 50 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
   - –í—Ä–µ–º—è: 5 –º–∏–Ω—É—Ç
   - –≠—Ñ—Ñ–µ–∫—Ç: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –ë–î

2. ‚úÖ **–ó–∞–º–µ–Ω–∏—Ç—å requests –Ω–∞ httpx**
   - –í—Ä–µ–º—è: 30 –º–∏–Ω—É—Ç
   - –≠—Ñ—Ñ–µ–∫—Ç: –£—Å–∫–æ—Ä–µ–Ω–∏–µ –º–µ–¥–∏–∞-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ 2-3 —Ä–∞–∑–∞

3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –¥–ª—è AI (max 10-15)**
   - –í—Ä–µ–º—è: 20 –º–∏–Ω—É—Ç
   - –≠—Ñ—Ñ–µ–∫—Ç: –ó–∞—â–∏—Ç–∞ –æ—Ç rate limiting

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

4. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ (TTL 5 –º–∏–Ω—É—Ç)
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (TTL 1 –º–∏–Ω—É—Ç–∞)

5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î**
   - Batch inserts –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã

6. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –ú–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
   - –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É–ª–∞ –ë–î

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)

7. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –Ω–∞ Railway
   - Load balancer

8. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–µ–¥–∏–∞**
   - –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ Vision
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –Ω–∞–≥—Ä—É–∑–∫–µ

- [ ] –ü—É–ª –ë–î —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 50 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- [ ] requests –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ httpx
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–µ—Ä–µ–¥—å –¥–ª—è AI –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:**
- –ó–∞–¥–µ—Ä–∂–∫–∏: 5-15 —Å–µ–∫—É–Ω–¥
- –†–∏—Å–∫ —Ç–∞–π–º–∞—É—Ç–æ–≤: –≤—ã—Å–æ–∫–∏–π
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ~50-70 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:**
- –ó–∞–¥–µ—Ä–∂–∫–∏: 2-5 —Å–µ–∫—É–Ω–¥ (–º–µ–¥–∏–∞), 1-3 —Å–µ–∫ (—Ç–µ–∫—Å—Ç)
- –†–∏—Å–∫ —Ç–∞–π–º–∞—É—Ç–æ–≤: –Ω–∏–∑–∫–∏–π
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ~100+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

---

## üéØ –í—ã–≤–æ–¥

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –≤—ã–¥–µ—Ä–∂–∏—Ç 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ 1 (1-2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã) –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.
